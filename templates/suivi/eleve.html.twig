{% extends 'base.html.twig' %}

{% block body %}
<div class="min-h-screen bg-[#ECECEC]">
    <div class="container mx-auto px-4 py-8">
        {# Header Section #}
        <div class="bg-[#1B4255] text-white rounded-lg p-6 mb-8 shadow-lg">
            <h1 class="text-3xl font-bold">Suivi de {{ eleve.prenom }} {{ eleve.nom }}</h1>
            <p class="text-[#70F9D9] mt-2">Dashboard de progression</p>
        </div>

        {# Progress Chart Section #}
        <div class="bg-white rounded-lg shadow-lg mb-8 overflow-hidden">
            <div class="bg-[#567C8D] text-white p-4">
                <h2 class="text-xl font-semibold">Progression</h2>
            </div>
            <div class="p-6">
                <canvas id="progressionChart" class="w-full" height="300"></canvas>
            </div>
        </div>

        {# Recent Sessions Section #}
        <div class="bg-white rounded-lg shadow-lg overflow-hidden">
            <div class="bg-[#567C8D] text-white p-4 flex justify-between items-center">
                <h2 class="text-xl font-semibold">Séances récentes</h2>
                <span class="bg-[#FFD700] text-[#1B4255] px-4 py-1 rounded-full text-sm font-semibold">
                    {{ seances|length }} séances
                </span>
            </div>

            <div class="divide-y divide-gray-200">
                {% for seance in seances %}
                <div class="p-6 hover:bg-[#ECECEC] transition-colors duration-200">
                    <div class="flex justify-between items-center">
                        <div>
                            <h3 class="text-lg font-medium text-[#1B4255]">
                                {{ seance.matiere.nom }}
                            </h3>
                            <span class="text-sm text-[#567C8D]">
                                {{ seance.date|date('d/m/Y') }}
                            </span>
                        </div>
                        <div class="bg-[#1B4255] text-white px-4 py-1 rounded-full text-sm">
                            Prof: {{ seance.professeur.prenom }}
                        </div>
                    </div>

                    <div class="mt-4 space-y-4">
                        <div class="bg-[#ECECEC] p-4 rounded-lg">
                            <h4 class="font-medium text-[#1B4255] mb-2">Compte-rendu :</h4>
                            <p class="text-[#567C8D]">{{ seance.compte_rendu }}</p>
                        </div>

                        <div class="bg-[#ECECEC] p-4 rounded-lg">
                            <h4 class="font-medium text-[#1B4255] mb-2">Travail à faire :</h4>
                            <p class="text-[#567C8D]">{{ seance.travail_maison }}</p>
                        </div>
                    </div>
                </div>
                {% endfor %}
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function () {
        const ctx = document.getElementById('progressionChart').getContext('2d');
        const progressionData = {{ progressions| json_encode | raw
    }};

    const chartColors = ['#FFD700', '#70F9D9', '#567C8D'];

    new Chart(ctx, {
        type: 'line',
        data: {
            labels: progressionData.dates,
            datasets: progressionData.matieres.map((matiere, index) => ({
                label: matiere.nom,
                data: matiere.niveaux,
                borderColor: chartColors[index % chartColors.length],
                backgroundColor: `${chartColors[index % chartColors.length]}20`,
                borderWidth: 2,
                tension: 0.4,
                fill: true,
                pointBackgroundColor: chartColors[index % chartColors.length],
                pointRadius: 4,
                pointHoverRadius: 6
            }))
        },
        options: {
            responsive: true,
            plugins: {
                legend: {
                    position: 'top',
                    labels: {
                        usePointStyle: true,
                        padding: 20,
                        font: {
                            family: 'system-ui'
                        }
                    }
                }
            },
            scales: {
                y: {
                    beginAtZero: true,
                    max: 20,
                    grid: {
                        color: '#ECECEC'
                    },
                    ticks: {
                        font: {
                            family: 'system-ui'
                        }
                    }
                },
                x: {
                    grid: {
                        color: '#ECECEC'
                    },
                    ticks: {
                        font: {
                            family: 'system-ui'
                        }
                    }
                }
            },
            interaction: {
                intersect: false,
                mode: 'index'
            },
            animation: {
                duration: 1000,
                easing: 'easeInOutQuart'
            }
        }
    });
});
</script>
{% endblock %}