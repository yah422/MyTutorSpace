{% extends 'base.html.twig' %}

{% block title %}Mes Réservations{% endblock %}

{% block body %}
<main class="w-full max-w-screen-xl mx-auto p-4">
<h1 class="text-3xl font-semibold text-gray-800 mb-6">Mes Réservations</h1>

{% if bookings is not empty %}
<div class="overflow-x-auto bg-white shadow-lg rounded-lg">
    <table class="w-full table-auto border-collapse">
        <thead class="bg-gray-100 text-gray-700">
            <tr>
                <th class="px-6 py-3 text-left text-sm font-medium">Cours</th>
                <th class="px-6 py-3 text-left text-sm font-medium">Date</th>
                <th class="px-6 py-3 text-left text-sm font-medium">Tuteur/Élève</th>
                <th class="px-6 py-3 text-left text-sm font-medium">Statut</th>
                <th class="px-6 py-3 text-left text-sm font-medium">Actions</th>
            </tr>
        </thead>
        <tbody class="text-gray-600">
            {% for booking in bookings %}
            <tr class="border-b hover:bg-gray-50">
                <td class="px-6 py-4 text-sm">{{ booking.matiere.nom }}</td>
                <td class="px-6 py-4 text-sm">{{ booking.preferredDate|date('d/m/Y H:i') }}</td>
                <td class="px-6 py-4 text-sm">
                    {% if 'ROLE_TUTEUR' in app.user.roles %}
                    {{ booking.studentName }} {{ booking.studentName }}
                    {% elseif 'ROLE_PARENT' in app.user.roles %}
                    {{ booking.studentName }} {{ booking.studentName }}
                    {% else %}
                    {{ booking.tuteur.nom }} {{ booking.tuteur.prenom }}
                    {% endif %}
                </td>
                <td class="px-6 py-4 text-sm">
                    <span class="inline-block px-3 py-1 rounded-full text-xs font-medium 
                                {% if booking.status == 'confirmed' %} bg-green-200 text-green-800 {% elseif booking.status == 'canceled' %} bg-red-200 text-red-800 {% else %} bg-yellow-200 text-yellow-800 {% endif %}
                            ">
                        {{ booking.status|capitalize }}
                    </span>
                </td>
                <td class="px-6 py-4 text-sm">
                    {% if 'ROLE_TUTEUR' in app.user.roles and app.user.roles and booking.status == 'pending' %}
                    <a href="{{ path('booking_confirm', { id: booking.id }) }}"
                        class="bg-green-500 hover:bg-green-700 text-white py-2 px-4 rounded-full text-sm font-semibold transition duration-300">
                        Confirmer
                    </a>
                    <a href="{{ path('booking_cancel', { id: booking.id }) }}"
                        class="bg-red-500 hover:bg-red-700 text-white py-2 px-4 rounded-full text-sm font-semibold transition duration-300 ml-2">
                        Annuler
                    </a>
                    {% endif %}
                </td>
            </tr>
            {% endfor %}
        </tbody>
    </table>
</div>
{% else %}
<p class="text-gray-500 text-lg">Aucune réservation trouvée.</p>
{% endif %}
</main>
{% endblock %}